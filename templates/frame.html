<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>프레임선택</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>
      body {
        font-family: "Arial", sans-serif;
        background-color: #f8f9fa;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .container {
        position: relative;
        width: 55%;
        padding: 20px;
      }
      .paletteContainer {
        position: relative;
        width: 75%;
        padding: 20px;
      }
      .basic,
      .wide,
      .palette {
        background-color: white;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        height: 70vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
      }
    
      .basic {
        width: 250px;
      }
    
      .basic .inner-div,
      .wide .inner-div {
        background-color: #dee2e6;
        width: 100%;
        margin-bottom: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
      }
      .basic .inner-div {
        height: 150px;
        margin-bottom: 20px;
      }
      .basic .inner-div:last-child {
        margin-bottom: 0;
      }
      .wide .inner-div {
        height: 235px;
      }
      .arrowNext {
        position: absolute;
        right: 20px;
        top: 50%;
        cursor: pointer;
        display: none;
      }
      .arrowPrev {
        position: absolute;
        left: 20px;
        top: 50%;
        cursor: pointer;
      }
      .clicked {
        background-color: #feffd5 !important;
        box-shadow: 0 20px 30px rgba(0, 0, 0, 0.5) !important;
      }
      .inner-div img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .inner-div input[type="file"] {
        opacity: 0;
        position: absolute;
        top: 0;
        left: 0;
        cursor: pointer;
      }
      .inner-div label {
        position: absolute;
        z-index: 1;
        color: #6c757d;
        font-size: 1.2rem;
      }
      .buttonGroup {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }
      .paletteLine {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 10px;
        flex-direction: row;
        margin-bottom: 10px;
      }
      .colorPalette {
        width: 70px;
        height: 70px;
        border-radius: 15%;
        cursor: pointer;
      }
      label {
        width: 170px;
        height: 110px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        margin: auto;
      }
      .buttonGroup button {
        padding: 15px;
        margin-top: 10px;
        border: none;
        border-radius: 10px;
        background-color: #000000;
        color: white;
        cursor: pointer;
        font-size: x-large;
      }
      #basicContent {
        padding-left: 110px;
      }
    </style>
    
  </head>
  <body>
    <div class="container" id="step1">
      <div class="row align-items-center justify-content-between">
        <div class="col-md-4">
          <div class="basic" id="basicSection">
            <div class="inner-div">
              <img src="../static/images/ex_basic1.jpeg" alt="ex_basic1" />
            </div>
            <div class="inner-div">
              <img src="../static/images/ex_basic2.jpeg" alt="ex_basic2" />
            </div>
            <div class="inner-div">
              <img src="../static/images/ex_basic3.jpeg" alt="ex_basic3" />
            </div>
            <div class="inner-div">
              <img src="../static/images/ex_basic4.jpeg" alt="ex_basic4" />
            </div>
          </div>
          <h2 class="text-center mt-3">Basic</h2>
        </div>
        <div class="col-md-7">
          <div class="row wide" id="wideSection">
            <div class="col-6">
              <div class="inner-div">
                <img src="../static/images/ex_wide1.jpeg" alt="ex_wide1" />
              </div>
            </div>
            <div class="col-6">
              <div class="inner-div">
                <img src="../static/images/ex_wide2.jpeg" alt="ex_wide2" />
              </div>
            </div>
            <div class="col-6">
              <div class="inner-div">
                <img src="../static/images/ex_wide3.jpeg" alt="ex_wide3" />
              </div>
            </div>
            <div class="col-6">
              <div class="inner-div">
                <img src="../static/images/ex_wide4.jpeg" alt="ex_wide4" />
              </div>
            </div>
          </div>
          <h2 class="text-center mt-3">Wide</h2>
        </div>
      </div>
    </div>

    <p class="text-xl arrowNext" id="nextStep" onclick="toggleStep()">
      <i class="fa-solid fa-circle-arrow-right fa-beat" style="font-size: 50px"></i>
    </p>

    <p
      class="text-xl arrowPrev"
      id="prevStep"
      onclick="toggleStep()"
      style="display: none"
    >
      <i class="fa-solid fa-circle-arrow-left" style="font-size: 50px"></i>
    </p>

    <div class="paletteContainer" id="step2" style="display: none">
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="row align-items-center">
          <!-- Step 2 content goes here -->
          <div class="col-md" id="basicContent" style="display: none;">
            <div class="basic" id="basicCapture">
              <div class="inner-div">
                <label for="basicFile1">사진을 선택하세요</label>
                <input
                  type="file"
                  id="basicFile1"
                  name="photos"
                  accept="image/*"
                  onchange="previewImage(event, 'basicFile1')"
                />
                <img id="basicImg1" alt="Preview" style="display:none"/>
              </div>
              <div class="inner-div">
                <label for="basicFile2">사진을 선택하세요</label>
                <input
                  type="file"
                  id="basicFile2"
                  name="photos"
                  accept="image/*"
                  onchange="previewImage(event, 'basicFile2')"
                />
                <img id="basicImg2" alt="Preview" style="display:none"/>
              </div>
              <div class="inner-div">
                <label for="basicFile3">사진을 선택하세요</label>
                <input
                  type="file"
                  id="basicFile3"
                  name="photos"
                  accept="image/*"
                  onchange="previewImage(event, 'basicFile3')"
                />
                <img id="basicImg3" alt="Preview" style="display:none"/>
              </div>
              <div class="inner-div">
                <label for="basicFile4">사진을 선택하세요</label>
                <input
                  type="file"
                  id="basicFile4"
                  name="photos"
                  accept="image/*"
                  onchange="previewImage(event, 'basicFile4')"
                />
                <img id="basicImg4" alt="Preview" style="display:none"/>
              </div>
            </div>
          </div>
          <div class="col" id="wideContent" style="display: none">
            <div class="row wide" id="wideCapture">
              <div class="col-6">
                <div class="inner-div">
                  <label for="wideFile1">사진을 선택하세요</label>
                  <input
                    type="file"
                    id="wideFile1"
                    name="photos"
                    accept="image/*"
                    onchange="previewImage(event, 'wideFile1')"
                  />
                  <img id="wideImg1" alt="Preview" style="display:none"/>
                </div>
              </div>
              <div class="col-6">
                <div class="inner-div">
                  <label for="wideFile2">사진을 선택하세요</label>
                  <input
                    type="file"
                    id="wideFile2"
                    name="photos"
                    accept="image/*"
                    onchange="previewImage(event, 'wideFile2')"
                  />
                  <img id="wideImg2" alt="Preview" style="display:none"/>
                </div>
              </div>
              <div class="col-6">
                <div class="inner-div">
                  <label for="wideFile3">사진을 선택하세요</label>
                  <input
                    type="file"
                    id="wideFile3"
                    name="photos"
                    accept="image/*"
                    onchange="previewImage(event, 'wideFile3')"
                  />
                  <img id="wideImg3" alt="Preview" style="display:none"/>
                </div>
              </div>
              <div class="col-6">
                <div class="inner-div">
                  <label for="wideFile4">사진을 선택하세요</label>
                  <input
                    type="file"
                    id="wideFile4"
                    name="photos"
                    accept="image/*"
                    onchange="previewImage(event, 'wideFile4')"
                  />
                  <img id="wideImg4" alt="Preview" style="display:none"/>
                </div>
              </div>
            </div>
          </div>
            <div class="col-md-7" id="paletteContent">
            <div class="palette" id="paletteSection">

              <h3 style="margin-bottom: 25px;"><i class="fas fa-palette"> 프레임을 다양한 색상으로 변경해 보세요 !</i></h3>
              <div class="paletteLine">
              <div
                class="colorPalette"
                style="background-color: #ABDEE6"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #fffac4"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #9c9cc9"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #ffff72"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #ffd9ff"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              </div>
              <div class="paletteLine">
              <div
                class="colorPalette"
                style="background-color: #ff9494"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #c8d6fb"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #a2a2a2"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #ffdd00"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #e1ffc7"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              </div>
              <div class="paletteLine">
              <div
                class="colorPalette"
                style="background-color: #ffd7d7"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #f0bdff"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #ceffb0"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #8499ff"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              <div
                class="colorPalette"
                style="background-color: #abff81"
                onclick="handleColorClick(this.style.backgroundColor)"
              ></div>
              </div>
            </div>
            </div>
          </div>

          <div class="buttonGroup">
            <button type="button" onclick="sendPhotos()" id="sendPhotosButton">
              <i class="far fa-images"> 완성하기</i>
            </button>
            <button
              type="button"
              onclick="downLoadFrame()"
              id="downloadButton"
              style="display: none"
            >
            <i class="fas fa-file-download"> 다운로드</i>
            </button>
            <!-- <button
              type="button"
              id="shareButton"
              style="display: none"
            >
              게시하기
            </button> -->
          </div>
        </div>
      </form>

      <div class="toast-container bottom-0 start-50 translate-middle-x">
        <div
          id="liveToast"
          class="toast"
          role="alert"
          aria-live="assertive"
          aria-atomic="true"
        >
          <div class="toast-header">
            <strong class="me-auto">사진이 완성되었습니다</strong>
            <small>😀 📷</small>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="toast"
              aria-label="Close"
            ></button>
          </div>
          <div class="toast-body">
            <!-- 만들어진 이쁜 사진을 게시하거나 다운로드 해보세요! -->
            만들어진 이쁜 사진을 다운로드 해보세요!
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
      integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      // 선택된 섹션을 저장하는 전역 변수
      let selectedSection = null;
      // 선택된 색상값을 저장하는 변수 (default 는 흰색)
      let frameColor = '#ffffff';

      // Basic or Wide 선택 시 함수
      document
        .getElementById("basicSection")
        .addEventListener("click", function () {
          // 선택 시 NEXT 버튼 활성화
          document.getElementById("nextStep").style.display = "block";
          deselectAll();
          this.classList.add("clicked");
          selectedSection = "Basic";
        });

      document
        .getElementById("wideSection")
        .addEventListener("click", function () {
          // 선택 시 NEXT 버튼 활성화
          document.getElementById("nextStep").style.display = "block";
          deselectAll();
          this.classList.add("clicked");
          selectedSection = "Wide";
        });

      function deselectAll() {
        document.getElementById("basicSection").classList.remove("clicked");
        document.getElementById("wideSection").classList.remove("clicked");
      }

      // Next, Prev 버튼 클릭
      function toggleStep() {
        var step1 = document.getElementById("step1");
        var step2 = document.getElementById("step2");
        var arrowNext = document.getElementById("nextStep");
        var arrowPrev = document.getElementById("prevStep");

        if (step1.style.display === "none") {
          step1.style.display = "block";
          step2.style.display = "none";
          arrowNext.style.display = "block";
          arrowPrev.style.display = "none";
        } else {
          step1.style.display = "none";
          step2.style.display = "block";
          arrowNext.style.display = "none";
          arrowPrev.style.display = "block";
          // 선택된 섹션에 따라 다른 div 표시
          if (selectedSection === "Basic") {
            document.getElementById("basicContent").style.display = "block";
            document.getElementById("wideContent").style.display = "none";
          } else if (selectedSection === "Wide") {
            document.getElementById("basicContent").style.display = "none";
            document.getElementById("wideContent").style.display = "block";
          }
        }
      }

      // 이미지 미리보기 함수
      function previewImage(event, inputId) {
        var input = document.getElementById(inputId);
        var file = input.files[0];
        var reader = new FileReader();
        var imgId = inputId.replace("File", "Img");
        var img = document.getElementById(imgId);

        reader.onloadend = function () {
          img.src = reader.result;
          img.style.display = "block";
          input.previousElementSibling.style.display = "none";
        };

        if (file) {
          reader.readAsDataURL(file);
        }
      }

      // 이미지 전송 함수
      function sendPhotos() {
        // formData를 사용하여 파일 전송
        const formData = new FormData(document.getElementById("uploadForm"));
        formData.append("section", selectedSection); // Type값 (Basic or Wide) 추가
        formData.append("frameColor", frameColor); // 배경색값 추가
        fetch("/api/upload", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("이미지 전송 성공:", data);
            showToast();
            showOtherButtons();
          })
          .catch((error) => {
            alert("ERROR");
            console.error("이미지 전송 에러:", error);
          });
      }
      function showOtherButtons() {
        document.getElementById("sendPhotosButton").style.display = "none";
        document.getElementById("downloadButton").style.display = "block";
        //document.getElementById("shareButton").style.display = "block";
      }

      function showToast() {
        const toastLiveExample = document.getElementById("liveToast");
        const toastBootstrap =
          bootstrap.Toast.getOrCreateInstance(toastLiveExample);
        toastBootstrap.show();
      }

      function downLoadFrame() {
        if (selectedSection === "Basic") {
          html2canvas(document.querySelector("#basicCapture")).then(
            (canvas) => {
              saveAs(canvas.toDataURL("image/jpg"), "self4cut.jpg");
            }
          );
        } else if (selectedSection === "Wide") {
          html2canvas(document.querySelector("#wideCapture")).then((canvas) => {
            saveAs(canvas.toDataURL("image/jpg"), "self4cut.jpg");
          });
        }
      }

      function saveAs(uri, filename) {
        let link = document.createElement("a");
        if (typeof uri === "string") {
          link.href = uri;
          link.download = filename;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        } else {
          window.open(uri);
        }
      }

      function handleColorClick(color) {
        frameColor = color;
        const selectedContentId = selectedSection === "Basic" ? "basicCapture" : "wideCapture";
        document.getElementById(selectedContentId).style.backgroundColor = color;
      }
    </script>
  </body>
</html>

